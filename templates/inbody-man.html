<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENTION InBody Analys Man</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/FRwbMSBN/SENTION-logo-Black-Transparent-BG.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>

.header {
    background: #ffffff;
    width: 98%;
    height: 82px;
    color: #444444;
    padding: 1rem;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    position: static;
    top: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0 0 15px 15px;
    font-family: 'Verdana', sans-serif;
    font-size: 1rem;
    font-weight: medium;
    margin-bottom: 40px; /* Increased from 20px */
}

        /* Your existing styles here */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #F0EEEC;
        }

        .logo {
    position: absolute; /* Position the logo absolutely */
    top: 43px; /* Distance from the top of the page */
    left: 500px; /* Distance from the left of the page */
    width: auto; /* Set a fixed width for the logo */
    height: 30px; /* Maintain aspect ratio */
    z-index: 1000; /* Ensure it stays on top of other elements */
    border: none;
    box-shadow: none;
    border-radius: 0;
    
}
h1 {
font-size: 2rem;
color: #444444;
margin-bottom: 20px;
text-align: center;
font-family: 'Rajdhani'; /* Ändra till önskad font */
font-size: 2rem; /* Ändra storlek om det behövs */
font-weight: 500; /* Ändra tjocklek om det behövs */

}

.input-container {
    margin-bottom: 40px;
    margin-top: 40px; /* Added margin-top */
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    padding: 0 20px;
    box-sizing: border-box;
}

.input-group {
    position: relative;
    margin: 10px;
    min-width: 200px;
    z-index: 1000;
}

.input-group input {
    width: 180px;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 7px;
    font-size: 16px;
    background: white;
    transition: all 0.3s ease;
}

.input-group label {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: white;
    padding: 0 5px;
    color: #666;
    font-size: 16px;
    transition: all 0.3s ease;
    pointer-events: none;
}

.input-group input:focus ~ label,
.input-group input:not(:placeholder-shown) ~ label {
    top: -20px;
    transform: translateY(0) scale(0.9);
    background: white;
    color: #333;
}

.content-container {
    margin-top: 20px;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    justify-content: center;
    gap: 20px;
    width: 40%;
    margin-bottom: 50px;
    position: relative;
    padding-top: 40px; /* Added padding at the top */
    padding-left: 2.5%;
}

        .model-container {
            position: relative;
            margin-bottom: 20px;
            padding-top: 60px; /* Added padding to maintain circle positions */
        }

        img {
            max-width: 400px;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .text-box {
            max-width: 400px;
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-size: 0.9rem;
            line-height: 1.5;
            color: #333;
        }      

        
        .comment-container textarea {
            width: 100%;
            min-height: 50px;
            height: 300px;
            resize: vertical;
            padding: 15px;
            font-size: 0.9rem;
            line-height: 1.5;
            border: none;
            border-radius: 15px;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            background: #fff;
            color: #333;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            overflow: auto;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
    .circle {
        position: absolute;
        width: 120px;
        height: 120px;
        background: rgba(157, 194, 168, 0.8);
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: bold;
        color: white;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        text-align: center;
        transition: background-color 0.3s ease;
        z-index: 1500; /* Increased z-index to ensure circles are on top */
    }

    .circle .parameter {
        font-size: 1rem;
        font-weight: bold;
    }

    .circle .value-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }

    .circle .value {
        font-size: 1.2rem;
        font-weight: bold;
        margin-top: 5px;
        display: inline-block;
    }

    .trend-indicator {
        display: none;
        margin-left: 5px;
        font-size: 1.2rem;
        cursor: pointer;
        user-select: none;
        color: white;
    }

    .trend-indicator.show {
        display: inline-block;
    }

        .hidden-input {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            padding: 5px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
            display: none; /* Hidden by default */
            z-index: 10;
        }

        .circle input:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }


        .circle.vikt {
            top: 10%; /* Adjusted from 5% */
            left: 20%;
            transform: translate(-50%, -50%);
        }

        .circle.längd {
            top: 10%; /* Adjusted from 5% */
            right: 20%;
            transform: translate(50%, -50%);
        }

        .circle.muskelmassa {
            top: 40%;
            left: 15%;
            transform: translate(-50%, -50%);
        }

        .circle.muskelmassa:hover::after {
            content: "Skriv in muskelmassa i kilo, uträkningen av procent sker automatiskt";
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        .circle.fettprocent {
            top: 40%;
            right: 15%;
            transform: translate(50%, -50%);
        }

        .circle.ecw-ratio {
            bottom: 25%;
            left: 15%;
            transform: translate(-50%, 50%);
        }

        .circle.bmi {
            bottom: 25%;
            right: 15%;
            transform: translate(50%, 50%);
        }

        .circle.viceralt-fett {
            bottom: 1%;
            left: 50%;
            transform: translate(-50%, 50%);
        }

        .export-container {
        margin-top: 20px;
        text-align: center; /* Center the export button */
        }

        .export-container button {
    padding: 10px 20px;
    font-size: 1rem;
    background-color: #d6d2ce;
    color: rgb(0, 0, 0);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px; /* Add spacing between buttons */
}

.export-container button:hover {
    background-color: #b4aca4;
}

.footer-logo {
    height: 100px;
    width: auto;
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999;
    display: flex;
    justify-content: flex-end;
    margin-bottom: 0;
}

.footer-logo img {
    height: 100px;
    width: auto;
    opacity: 0.8;
    transition: opacity 0.3s ease;
    border: none;
    box-shadow: none;
    border-radius: 0;
}

        @media print {
    #export-button {
        display: none; /* Dölj exportknappen vid utskrift */
    }
}

.bottom-text-box {
    width: 90%;
    max-width: 1200px;
    background: #fff;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    font-size: 0.9rem;
    line-height: 1.5;
    color: #333;
    margin: 60px auto 20px auto;
    box-sizing: border-box;
    position: relative;
    z-index: 1;
}

@media print {
    .bottom-text-box {
        width: 100%;
        max-width: none;
        margin: 40px 0 20px 0;
        page-break-inside: avoid;
    }
    
    .footer-logo {
        display: none; /* Hide the fixed logo in print view */
    }
}

.comment-container {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

/* Add styles for trend indicators and controls */
.trend-toggle-container {
    margin: 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    justify-content: center;
    position: relative;
}

.trend-toggle {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.trend-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.trend-toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.trend-toggle-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

.trend-toggle input:checked + .trend-toggle-slider {
    background-color: #9DC2A8;
}

.trend-toggle input:checked + .trend-toggle-slider:before {
    transform: translateX(26px);
}

.trend-label {
    font-size: 1rem;
    color: #333;
}

.trend-selector {
    position: absolute;
    display: none;
    background: white;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 2000;
    top: 50%;
    right: calc(100% + 10px); /* Position it to the left with 10px gap */
    transform: translateY(-50%);
    width: 160px;
}

.trend-selector button {
    display: block;
    width: 100%;
    padding: 8px 12px;
    border: none;
    background: none;
    cursor: pointer;
    text-align: left;
    font-size: 1rem;
    color: #333;
    transition: background-color 0.2s;
    border-radius: 3px;
}

.trend-selector button:hover {
    background: #f0f0f0;
}

.trend-selector.show {
    display: block;
}

@media print {
    .trend-toggle-container,
    .trend-selector {
        display: none !important;
    }
}
    </style>
</head>
<body>
    <body>
        <div class="header">
            <h1>SENTION - InBody Analys</h1>
        </div>
        <div class="input-container">
            <div class="input-group">
                <input type="text" id="nameInput" placeholder=" " required>
                <label for="nameInput">Namn</label>
            </div>
            <div class="input-group">
                <input type="text" id="personnummerInput" placeholder=" " required>
                <label for="personnummerInput">Personnummer</label>
            </div>
            <div class="input-group">
                <input type="date" id="dateInput" placeholder=" " required>
                <label for="dateInput">Datum</label>
            </div>
        </div>

    <!-- Add trend toggle switch -->
    <div class="trend-toggle-container">
        <span class="trend-label">Visa trendpilar</span>
        <label class="trend-toggle">
            <input type="checkbox" id="trend-toggle">
            <span class="trend-toggle-slider"></span>
        </label>
    </div>

    <div class="content-container">
        <!-- Left Section: Model and Circles -->
        <div class="model-container">
            <img src="https://i.postimg.cc/d16bqdzB/Male-In-Body22.jpg" alt="Body Model">
            <div class="circle vikt" data-value="" onclick="showInput('vikt')">
                <div class="parameter">Vikt (kg):</div>
                <div class="value-container">
                    <div class="value" id="vikt-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'vikt')">–</span>
                </div>
                <input type="number" id="vikt-input" placeholder="0" oninput="updateCircle('vikt')" class="hidden-input">
            </div>
            <div class="circle längd" data-value="" onclick="showInput('längd')">
                <div class="parameter">Längd (cm):</div>
                <div class="value-container">
                    <div class="value" id="längd-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'längd')">–</span>
                </div>
                <input type="number" id="längd-input" placeholder="0" oninput="updateCircle('längd')" class="hidden-input">
            </div>
            <div class="circle muskelmassa" data-value="" onclick="showInput('muskelmassa')">
                <div class="parameter">Muskelmassa (%):</div>
                <div class="value-container">
                    <div class="value" id="muskelmassa-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'muskelmassa')">–</span>
                </div>
                <input type="number" id="muskelmassa-input" placeholder="0" oninput="updateCircle('muskelmassa')" class="hidden-input">
            </div>
            <div class="circle fettprocent" data-value="" onclick="showInput('fettprocent')">
                <div class="parameter">Fettprocent (%):</div>
                <div class="value-container">
                    <div class="value" id="fettprocent-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'fettprocent')">–</span>
                </div>
                <input type="number" id="fettprocent-input" placeholder="0" oninput="updateCircle('fettprocent')" class="hidden-input">
            </div>
            <div class="circle ecw-ratio" data-value="" onclick="showInput('ecw-ratio')">
                <div class="parameter">ECW Ratio:</div>
                <div class="value-container">
                    <div class="value" id="ecw-ratio-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'ecw-ratio')">–</span>
                </div>
                <input type="number" id="ecw-ratio-input" placeholder="0" oninput="updateCircle('ecw-ratio')" class="hidden-input">
            </div>
            <div class="circle bmi" data-value="" onclick="showInput('bmi')">
                <div class="parameter">BMI:</div>
                <div class="value-container">
                    <div class="value" id="bmi-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'bmi')">–</span>
                </div>
                <input type="number" id="bmi-input" placeholder="0" oninput="updateCircle('bmi')" class="hidden-input">
            </div>
            <div class="circle viceralt-fett" data-value="" onclick="showInput('viceralt-fett')">
                <div class="parameter">Viceralt Fett (cm&sup2;):</div>
                <div class="value-container">
                    <div class="value" id="viceralt-fett-value">-</div>
                    <span class="trend-indicator" data-trend="none" onclick="showTrendSelector(event, 'viceralt-fett')">–</span>
                </div>
                <input type="number" id="viceralt-fett-input" placeholder="0" oninput="updateCircle('viceralt-fett')" class="hidden-input">
            </div>
            
            <!-- Trend selector popup -->
            <div class="trend-selector" id="trend-selector">
                <button onclick="setTrend('increase')">↑ Ökning</button>
                <button onclick="setTrend('decrease')">↓ Minskning</button>
                <button onclick="setTrend('none')">– Ingen förändring</button>
                <button onclick="setTrend('hide')" style="border-top: 1px solid #eee;">Visa ingen trend</button>
            </div>
        </div>
    
       <!-- Right Section: Info Text -->
<div class="info-container">
    <!-- Kommentar Section -->
    <div class="comment-container">
        <h3>Tolkning och resultat</h3>
        <textarea id="kommentar-input" placeholder="Skriv din kommentar här..."></textarea>
        
        <!-- Add the "Tolkat av:" label and dropdown -->
        <div class="tolkat-av-container" style="margin-top: 10px;">
            <label for="tolkat-av" style="font-size: 1rem; font-weight: bold; color: #333;">Tolkat av:</label>
            <select id="tolkat-av" style="padding: 10px; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; margin-left: 10px;">
                <option value="overlakare-per-andersson">Överläkare Per "Pliggen" Andersson</option>
            </select>
        </div>
    </div>     

    <!-- Export Buttons -->
    <div class="export-container" style="margin-top: 20px;">
        <button id="export-button">Exportera Excel</button>
        <button id="export-model-pdf-button">Exportera Modell PDF</button>
    </div>
    <div class="footer-logo">
        <img src="https://i.postimg.cc/FRwbMSBN/SENTION-logo-Black-Transparent-BG.png" alt="Företagslogo">
    </div>
</div>
</div>

<!-- Add the text box here, after content-container -->
<div class="bottom-text-box">
    En analys av kroppssammansättning består av ett flertal komponenter och ger en indikation på fysisk hälsa och ger värdefull information om individens metabola status. Analysen är en central del för ett individanpassat upplägg av tränings- och kostprogram. Förutom en analys av fett och muskelmassa analyseras hur mycket fett som omger organen (visceralt fett). Höga nivåer av visceralt fett är en viktig orsak till låggradig inflammation som driver hjärt-kärl sjukdomar.
</div>
    
    
</body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>

    
document.getElementById('export-button').addEventListener('click', () => {
    const vikt = parseFloat(document.getElementById('vikt-input').value) || 0;
    const muskelmassaKg = parseFloat(document.getElementById('muskelmassa-input').value) || 0;
    const muskelmassaProcent = vikt > 0 ? ((muskelmassaKg / vikt) * 100).toFixed(2) : '-';

    // Hämta data från inputfält
    const name = document.getElementById('nameInput').value || 'Unnamed';
    const personnummer = document.getElementById('personnummerInput').value || '-';
    const date = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    const längd = document.getElementById('längd-input').value || '-';
    const fettprocent = document.getElementById('fettprocent-input').value || '-';
    const ecwRatio = document.getElementById('ecw-ratio-input').value || '-';
    const bmi = document.getElementById('bmi-input').value || '-';
    const viceraltFett = document.getElementById('viceralt-fett-input').value || '-';
    const kommentar = document.getElementById('kommentar-input').value || '-'; // Hämta kommentaren

    // Skapa rubriker (rad 1) och data (rad 2)
    const headers = [
        'Namn', 'Personnummer', 'Datum', 'Vikt (kg)', 'Längd (cm)', 
        'Muskelmassa (kg)', 'Muskelmassa (%)', 
        'Fettprocent (%)', 'ECW Ratio', 'BMI', 'Viceralt Fett', 'Kommentar'
    ];
    const values = [
        name, personnummer, date, vikt || '-', längd, 
        muskelmassaKg || '-', muskelmassaProcent || '-', 
        fettprocent, ecwRatio, bmi, viceraltFett, kommentar
    ];

    // Skapa Excel-arbetsboksobjekt
    const workbook = XLSX.utils.book_new();
    const worksheetData = [headers, values];
    const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
    
    // Lägg till arbetsbladet i arbetsboken
    XLSX.utils.book_append_sheet(workbook, worksheet, 'InBody Analys');
    
    // Skapa filnamnet med "InBody_Name_Personnummer"
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0]; // YYYY-MM-DD
    const sanitizedPersonnummer = personnummer.replace(/[^a-zA-Z0-9]/g, ''); // Remove special characters
    const filename = `InBody_${name}_${sanitizedPersonnummer}_${formattedDate}.xlsx`;
    
    // Ladda ner Excel-filen
    XLSX.writeFile(workbook, filename);
});



// Add new function for exporting just the model to PDF
document.getElementById('export-model-pdf-button').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    
    // Create a temporary container for the model
    const modelContainer = document.createElement('div');
    modelContainer.style.cssText = `
        position: fixed;
        left: -9999px;
        width: 794px; /* A4 width in pixels */
        height: 1123px; /* A4 height in pixels */
        background-color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    `;
    
    // Clone the model container
    const modelContent = document.querySelector('.model-container').cloneNode(true);
    modelContent.style.cssText = `
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0;
        margin: 0;
        background-color: #f0f0f0;
    `;
    
    // Adjust the image size to fill the page
    const modelImage = modelContent.querySelector('img');
    modelImage.style.cssText = `
        width: 100%;
        height: 100%;
        object-fit: cover;
        margin: 0;
        padding: 0;
        display: block;
        box-shadow: none;
        border-radius: 0;
    `;

    // Create a grey background div that fills the entire space
    const greyBackground = document.createElement('div');
    greyBackground.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #D3D3D3;
        z-index: 0;
    `;
    modelContent.insertBefore(greyBackground, modelContent.firstChild);

    // Ensure the model image is centered and covers the full height
    modelImage.style.position = 'absolute';
    modelImage.style.left = '50%';
    modelImage.style.top = '50%';
    modelImage.style.transform = 'translate(-50%, -50%)';
    modelImage.style.height = '100%';
    modelImage.style.width = 'auto';
    modelImage.style.maxWidth = 'none';

    // Adjust circle positions and sizes relative to the page size
    const circles = modelContent.querySelectorAll('.circle');
    circles.forEach(circle => {
        circle.style.width = '185px';
        circle.style.height = '185px';
        circle.style.fontSize = '24px';  // Base font size increased
        circle.style.zIndex = '2';
        circle.style.padding = '15px';  // Added padding to ensure text stays within circle
        
        // Find and adjust the parameter and value text sizes
        const parameterDiv = circle.querySelector('.parameter');
        const valueDiv = circle.querySelector('.value');
        
        if (parameterDiv) {
            parameterDiv.style.fontSize = '22px';  // Parameter text slightly smaller
            parameterDiv.style.marginBottom = '8px';  // Added space between parameter and value
            parameterDiv.style.lineHeight = '1.2';  // Improved line height for better readability
        }
        
        if (valueDiv) {
            valueDiv.style.fontSize = '28px';  // Value text larger for emphasis
            valueDiv.style.lineHeight = '1.2';  // Consistent line height
            valueDiv.style.marginTop = '4px';  // Added space above value
        }

        // Keep the same positions but adjust transform to account for larger size
        if (circle.classList.contains('vikt')) {
            circle.style.top = '12%';
            circle.style.left = '25%';
            circle.style.transform = 'translate(-50%, -50%)';
        } else if (circle.classList.contains('längd')) {
            circle.style.top = '12%';
            circle.style.right = '25%';
            circle.style.transform = 'translate(50%, -50%)';
        } else if (circle.classList.contains('muskelmassa')) {
            circle.style.top = '40%';
            circle.style.left = '15%';
            circle.style.transform = 'translate(-50%, -50%)';
        } else if (circle.classList.contains('fettprocent')) {
            circle.style.top = '40%';
            circle.style.right = '15%';
            circle.style.transform = 'translate(50%, -50%)';
        } else if (circle.classList.contains('ecw-ratio')) {
            circle.style.bottom = '25%';
            circle.style.left = '15%';
            circle.style.transform = 'translate(-50%, 50%)';
        } else if (circle.classList.contains('bmi')) {
            circle.style.bottom = '25%';
            circle.style.right = '15%';
            circle.style.transform = 'translate(50%, 50%)';
        } else if (circle.classList.contains('viceralt-fett')) {
            circle.style.bottom = '12%';
            circle.style.left = '50%';
            circle.style.transform = 'translate(-50%, 50%)';
        }
    });
    
    modelContainer.appendChild(modelContent);
    document.body.appendChild(modelContainer);
    
    // Create loading indicator
    const loadingIndicator = document.createElement('div');
    loadingIndicator.innerText = 'Skapar PDF av modell, var god vänta...';
    loadingIndicator.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 9999;
    `;
    document.body.appendChild(loadingIndicator);
    
    setTimeout(() => {
        html2canvas(modelContainer, {
            scale: 2,
            useCORS: true,
            backgroundColor: '#D3D3D3',
            width: modelContainer.offsetWidth,
            height: modelContainer.offsetHeight
        }).then(canvas => {
            const pdf = new jsPDF('p', 'pt', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            
            // Add image to fill the entire page
            pdf.addImage(
                canvas.toDataURL('image/jpeg', 1.0),
                'JPEG',
                0,
                0,
                pageWidth,
                pageHeight
            );
            
            // Generate filename
            const name = document.getElementById('nameInput').value || 'Unnamed';
            const personnummer = document.getElementById('personnummerInput').value || '';
            const date = new Date().toISOString().split('T')[0];
            const sanitizedName = name.replace(/[^a-zA-Z0-9 ]/g, '').replace(/\s+/g, '_');
            const sanitizedPersonnummer = personnummer.replace(/[^a-zA-Z0-9]/g, '');
            
            pdf.save(`InBody_Model_${sanitizedName}_${sanitizedPersonnummer}_${date}.pdf`);
            
            // Cleanup
            document.body.removeChild(modelContainer);
            document.body.removeChild(loadingIndicator);
        });
    }, 100);
});

const parameterRanges = {
    muskelmassa: { 
        bad: [0, 32.9], // Under 33% = red
        moderate: [33, 35.9], // 33-36% = yellow
        great: [36, 100] // Over 36% = green
    },
    fettprocent: { 
        badLow: [0, 9.9], // Below 10% = red
        bad: [25.1, 100], // Over 25% = red
        moderate: [21, 25], // 21-25% = yellow
        great: [10, 20] // 10-20% = green
    },
    "ecw-ratio": { 
        bad: [0.391, 100], // Above 0.390 = red
        moderate: [0.361, 0.390], // 0.361-0.390 = yellow
        great: [0, 0.360] // 0.360 or below = green
    },
    bmi: { 
        bad: [0, 18.4], // Under 18.5 = red
        moderate: [25, 29.9], // 25-29.9 = yellow
        great: [18.5, 24.9], // 18.5-24.9 = green
        obese: [30, 100] // 30 or higher = red
    },
    "viceralt-fett": { 
        bad: [100, 1000], // Above 100 cm² = red
        great: [0, 99.9] // Under 100 cm² = green
    }
};

function updateCircle(parameter) {
    const input = document.getElementById(`${parameter}-input`);
    const valueSpan = document.getElementById(`${parameter}-value`);
    const circle = document.querySelector(`.circle.${parameter}`);
    const value = parseFloat(input.value);

    // Update the displayed value
    valueSpan.textContent = input.value || '-';

    // Skip color updates for "vikt" and "längd"
    if (parameter === "vikt" || parameter === "längd") {
        circle.style.backgroundColor = "rgba(147, 164, 182, 0.8)"; // Neutral blågrå färg för basvärden
        return;
    }

    // Determine the color based on the value
    const ranges = parameterRanges[parameter];
    if (ranges && !isNaN(value)) {
        if (parameter === "bmi") {
            // Special logic for BMI
            if (value < 18.5) {
                circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Undervikt - mjukare röd
            } else if (value >= 18.5 && value <= 24.9) {
                circle.style.backgroundColor = "rgba(156, 204, 156, 0.8)"; // Normalvikt - mjukare grön
            } else if (value >= 25 && value <= 29.9) {
                circle.style.backgroundColor = "rgba(241, 218, 123, 0.8)"; // Övervikt - mjukare gul
            } else if (value >= 30) {
                circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Fetma - mjukare röd
            } else {
                circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)"; // Default color
            }
        } else if (parameter === "muskelmassa") {
            // Special logic for Muskelmassa
            const viktValue = parseFloat(document.getElementById("vikt-input").value);
            const muskelmassaValue = parseFloat(input.value);

            if (!isNaN(viktValue) && viktValue > 0 && !isNaN(muskelmassaValue)) {
                const percentage = (muskelmassaValue / viktValue) * 100;
                valueSpan.textContent = `${percentage.toFixed(2)}`;

                if (percentage >= 36) {
                    circle.style.backgroundColor = "rgba(156, 204, 156, 0.8)"; // Good - mjukare grön
                } else if (percentage >= 33 && percentage < 36) {
                    circle.style.backgroundColor = "rgba(241, 218, 123, 0.8)"; // Moderate - mjukare gul
                } else {
                    circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Bad - mjukare röd
                }
            } else {
                valueSpan.textContent = "-";
                circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)";
            }
        } else if (parameter === "fettprocent") {
            if (value >= 10 && value <= 20) {
                circle.style.backgroundColor = "rgba(156, 204, 156, 0.8)"; // Green
            } else if ((value > 20 && value <= 25)) {
                circle.style.backgroundColor = "rgba(241, 218, 123, 0.8)"; // Yellow
            } else if (value < 10 || value > 25) {
                circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Red
            } else {
                circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)";
            }
        } else if (parameter === "ecw-ratio") {
            if (value <= 0.359) {
                circle.style.backgroundColor = "rgba(241, 218, 123, 0.8)"; // Yellow
            } else if (value > 0.359 && value <= 0.390) {
                circle.style.backgroundColor = "rgba(156, 204, 156, 0.8)"; // Green
            } else if (value > 0.390 && value <= 0.399) {
                circle.style.backgroundColor = "rgba(241, 218, 123, 0.8)"; // Yellow
            } else if (value > 0.399) {
                circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Red
            } else {
                circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)";
            }
        } else if (parameter === "viceralt-fett") {
            if (value < 100) {
                circle.style.backgroundColor = "rgba(156, 204, 156, 0.8)"; // Green
            } else if (value >= 100) {
                circle.style.backgroundColor = "rgba(235, 127, 127, 0.8)"; // Red
            } else {
                circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)";
            }
        } else {
            circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)"; // Default color if no ranges are defined or value is invalid
        }
    } else {
        circle.style.backgroundColor = "rgba(157, 194, 168, 0.8)"; // Default color if no ranges are defined or value is invalid
    }
}

document.getElementById("vikt-input").addEventListener("input", () => {
    updateCircle("muskelmassa");
});

// Show the input field when a circle is clicked
function showInput(parameter) {
    // Hide all other input fields
    document.querySelectorAll('.hidden-input').forEach(input => {
        input.style.display = 'none';
    });

    // Show the input field for the clicked circle
    const input = document.getElementById(`${parameter}-input`);
    input.style.display = 'block';
    input.focus(); // Focus on the input field
}

// Hide input fields when clicking outside
document.addEventListener('click', (event) => {
    const isCircle = event.target.closest('.circle'); // Check if the click is inside a circle
    if (!isCircle) {
        document.querySelectorAll('.hidden-input').forEach(input => {
            input.style.display = 'none'; // Hide all input fields
        });
    }
});

        const nameInput = document.querySelector('input[type="text"]');

    nameInput.addEventListener('input', function () {
        // Create a temporary span element to measure the text width
        const tempSpan = document.createElement('span');
        tempSpan.style.visibility = 'hidden';
        tempSpan.style.position = 'absolute';
        tempSpan.style.whiteSpace = 'nowrap';
        tempSpan.style.fontSize = window.getComputedStyle(this).fontSize;
        tempSpan.style.fontFamily = window.getComputedStyle(this).fontFamily;
        tempSpan.textContent = this.value || this.placeholder;

        document.body.appendChild(tempSpan);
        const newWidth = tempSpan.offsetWidth + 20; // Add some padding
        this.style.width = `${newWidth}px`;
        document.body.removeChild(tempSpan);
    });

    // Auto-expand the "Tolkning och resultat" textarea as the user types
const kommentarTextarea = document.getElementById('kommentar-input');

kommentarTextarea.addEventListener('input', function () {
    this.style.height = 'auto'; // Reset the height to calculate the new height
    this.style.height = `${this.scrollHeight}px`; // Set the height to fit the content
});

// Initialize the height on page load (in case there's pre-filled content)
window.addEventListener('load', function () {
    kommentarTextarea.style.height = 'auto';
    kommentarTextarea.style.height = `${kommentarTextarea.scrollHeight}px`;
});

// Add trend indicator functionality
let currentTrendParameter = null;
const trendToggle = document.getElementById('trend-toggle');
const trendSelector = document.getElementById('trend-selector');
const trendIndicators = document.querySelectorAll('.trend-indicator');

// Initialize trend visibility based on toggle state
function updateTrendVisibility() {
    const showTrends = trendToggle.checked;
    trendIndicators.forEach(indicator => {
        indicator.classList.toggle('show', showTrends);
    });
}

// Toggle trend indicators visibility
trendToggle.addEventListener('change', updateTrendVisibility);

// Show trend selector popup
function showTrendSelector(event, parameter) {
    event.stopPropagation(); // Prevent circle click event
    
    const trendSelector = document.getElementById('trend-selector');
    trendSelector.classList.add('show');
    currentTrendParameter = parameter;
}

// Set trend for a parameter
function setTrend(trend) {
    if (!currentTrendParameter) return;
    
    const indicator = document.querySelector(`.circle.${currentTrendParameter} .trend-indicator`);
    if (indicator) {
        indicator.dataset.trend = trend;
        if (trend === 'hide') {
            indicator.style.display = 'none';
            indicator.classList.remove('show');
        } else {
            indicator.style.display = '';
            indicator.classList.add('show');
            switch (trend) {
                case 'increase':
                    indicator.textContent = '↑';
                    break;
                case 'decrease':
                    indicator.textContent = '↓';
                    break;
                default:
                    indicator.textContent = '–';
            }
        }
    }
    
    document.getElementById('trend-selector').classList.remove('show');
    currentTrendParameter = null;
}

// Close trend selector when clicking outside
document.addEventListener('click', (event) => {
    const trendSelector = document.getElementById('trend-selector');
    if (!event.target.closest('.trend-indicator') && !event.target.closest('.trend-selector')) {
        trendSelector.classList.remove('show');
        currentTrendParameter = null;
    }
});



// Initialize trend visibility
updateTrendVisibility();
    </script>
</body>
</html>